<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Wuer">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Wuer">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wuer">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>Wuer</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wuer</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/17/jQuery对象和原生Dom对象区别及相互转换/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/17/jQuery对象和原生Dom对象区别及相互转换/" itemprop="url">jQuery对象和原生Dom对象区别及相互转换</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-17T16:04:15+08:00">
                2018-12-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、区别"><a href="#一、区别" class="headerlink" title="一、区别"></a>一、区别</h1><p>(1)  <strong>jQuery 对象：</strong>通过jQuery包装DOM对象后产生的对象</p>
<p>假设获取header元素内的文本内容,其中<strong>text()是jQuery里的方法</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.header'</span>).text()</span><br></pre></td></tr></table></figure></p>
<p>等同于<strong>DOM对象实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.header'</span>).innerText</span><br></pre></td></tr></table></figure>
<p>(2)  <strong>DOM对象：</strong>w3c标准用于操作文档的API</p>
<h1 id="二、DOM对象转jQuery对象"><a href="#二、DOM对象转jQuery对象" class="headerlink" title="二、DOM对象转jQuery对象"></a>二、DOM对象转jQuery对象</h1><p>把DOM对象包装起来【$(DOM对象)】，就可以获得一个jQuery对象了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> header = <span class="built_in">document</span>.querySelector(<span class="string">'.header'</span>)  <span class="comment">//Dom 对象</span></span><br><span class="line">$header = $(header) <span class="comment">//jQuery对象</span></span><br></pre></td></tr></table></figure>
<h1 id="三、jQuery对象转DOM对象"><a href="#三、jQuery对象转DOM对象" class="headerlink" title="三、jQuery对象转DOM对象"></a>三、jQuery对象转DOM对象</h1><p>jQuery对象是类数组对象，通过数组下标方式获取jQuery中的DOM对象<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$p[<span class="number">0</span>]   <span class="comment">//选中了第一个dom对象</span></span><br></pre></td></tr></table></figure></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>可以任意的相互转换jQuery对象和DOM对象。<br><strong>但，jQuery对象是jQuery独有的，只能使用jQuery里的方法，不能使用DOM的方法，反之一样</strong><br>像类似下面的写法是不可以的，这样子会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.header'</span>).innerText</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.header'</span>).text()</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/17/jQuery之DOM操作、属性、函数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/17/jQuery之DOM操作、属性、函数/" itemprop="url">jQuery之DOM操作、属性、函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-17T13:26:37+08:00">
                2018-12-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、DOM操作"><a href="#一、DOM操作" class="headerlink" title="一、DOM操作"></a>一、DOM操作</h1><h3 id="A、创建元素"><a href="#A、创建元素" class="headerlink" title="A、创建元素"></a>A、创建元素</h3><p>只需要把DOM字符串传入 $ 方法即可返回一个jQuery对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = $(<span class="string">'&lt;div class="test"&gt;&lt;p&gt;&lt;span&gt;Done&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;'</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-d352524426d7770c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="B、添加元素"><a href="#B、添加元素" class="headerlink" title="B、添加元素"></a>B、添加元素</h3><p>(1)  .append(content[,content]) / .append(function(index,html))</p>
<ul>
<li>可以一次添加多个内容，内容可以是DOM对象、HTML string、 jQuery对象</li>
<li>如果参数是function，function可以返回DOM对象、HTML string、 jQuery对象，参数是集合中的元素位置与原来的html值</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-e479978f4956892f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  .prepend(content[,content]) / .prepend(function(index,html))</p>
<p>向<strong>对象头部</strong>追加内容，用法和append类似，内容<strong>添加到最开始</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-ba189a1015d84a37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3) .before([content][,content]) / .before(function)</p>
<p>在对象前面(<strong>不是头部，而是外面，和对象并列同级</strong>)插入内容，参数和append类似</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-ae94968ffc102f32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4) .after([content][,content]) / .after(function（index）)</p>
<p>和before相反，在对象后面(<strong>不是尾部，而是外面，和对象并列同级</strong>)插入内容，参数和append类似</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-fc4f9f67af1cb0da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="C、删除元素"><a href="#C、删除元素" class="headerlink" title="C、删除元素"></a>C、删除元素</h3><p>(1)  .remove([selector])</p>
<p>删除被选元素（及其子元素）,也可以添加一个<strong>可选的选择器参数</strong>来过滤匹配的元素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-c3181833189d95b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  empty()</p>
<p>清空被选择元素内所有子元素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-1630eb6bd974fc49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="D、包裹元素"><a href="#D、包裹元素" class="headerlink" title="D、包裹元素"></a>D、包裹元素</h3><p>(1)  .html([string])<br>这是一个<strong>读写两用</strong>的方法，用于<strong>获取/修改</strong>元素的<strong>innerHTML</strong></p>
<ul>
<li>当没有传递参数的时候，返回元素的innerHTML</li>
<li>当传递了一个string参数的时候，修改元素的innerHTML为参数</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-ecdbc9b6ebabc2b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>其中，特别注意：读写两用的方法很多，原理都类似</p>
<ul>
<li><p>如果<strong>结果是多个进行赋</strong>值操作的时候会给<strong>每个结果都赋值</strong></p>
</li>
<li><p>如果<strong>结果多个，获取值</strong>的时候，返回结果集中的<strong>第一个对象</strong>的相应值</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-b65f74e09094a294.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2) .text()<br>和html方法类似，操作的是<strong>DOM的innerText</strong>值</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-ce4dff1fd7d144ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="二、属性及css操作"><a href="#二、属性及css操作" class="headerlink" title="二、属性及css操作"></a>二、属性及css操作</h1><h3 id="A、属性"><a href="#A、属性" class="headerlink" title="A、属性"></a>A、属性</h3><p>(1)  .val([value])</p>
<p>这是一个读写双用的方法，用来处理input的value，当方法没有参数的时候返回input的value值，当传递了一个参数的时候，方法修改input的value值为参数值</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-7610f39f79333fd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  .attr() / .attr(attributeName)</p>
<p>获取元素特定属性的值</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-714717eb82771581.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="https://upload-images.jianshu.io/upload_images/14339384-bf7c43c4adc6d000.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3)  .removeAttr()</p>
<p>为匹配的元素集合中的每个元素中移除一个属性（attribute）</p>
<p>.removeAttr() 方法使用原生的 JavaScript removeAttribute() 函数,但是它的优点是可以直接在一个 jQuery 对象上调用该方法，并且它解决了跨浏览器的属性名不同的问题。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-99d2aaa5af1686b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4)  .prop()/.removeProp()<br>这两个方法是用来操作元素的property的，property和attibute是非常相似的概念</p>
<p>可参考  <a href="https://blog.jirengu.com/?p=222" target="_blank" rel="noopener">https://blog.jirengu.com/?p=222</a></p>
<h3 id="B、css操作"><a href="#B、css操作" class="headerlink" title="B、css操作"></a>B、css操作</h3><p>(1)  .css()</p>
<p>和 attr 非常相似的方法，用来处理元素的css</p>
<p>.css(propertyName) / .css(propertyNames)</p>
<p>获取元素style特定property的值</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-b5fa52f785444582.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  .addClass(className) / .removeClass(className)</p>
<p>.addClass(className) / .addClass(function(index,currentClass))</p>
<p>为元素添加class，不是覆盖原class，是追加，也不会检查重复</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-051026893a23afdf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3)  removeClass([className]) / ,removeClass(function(index,class))</p>
<p>移除元素单个/多个/所有class</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-e3c61ec617f0fac9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4)  .hasClass(className)</p>
<p>检查元素是否包含某个class，返回true/false</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-5bd990d600152a85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(5)  .toggleClass(className)</p>
<p>toggle是切换的意思，方法用于切换</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-86ccdbf19df1deb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="三、常用方法"><a href="#三、常用方法" class="headerlink" title="三、常用方法"></a>三、常用方法</h1><p>(1)  .each( function(index, Element) )</p>
<p>遍历一个jQuery对象，为每个匹配元素执行一个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'li'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"> index </span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log( index + <span class="string">":"</span> + $(<span class="keyword">this</span>).text() );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-a709afc2c5fe34ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  jQuery.extend([deep,] target [, object1 ][, objectN ] )</p>
<ul>
<li><p>当我们提供<strong>两个或多个对象</strong>给 $.extend()，对象的<strong>所有属性都添加到目标对象</strong>（target参数）。</p>
</li>
<li><p>如果<strong>只有一个参数</strong>提供给 $.extend()，这意味着目标参数被省略。在这种情况下，jQuery<strong>对象本身被默认为目标对象</strong>。这样，我们可以在jQuery的命名空间下添加新的功能。这对于插件开发者希望向 jQuery 中添加新函数时是很有用的</p>
</li>
</ul>
<p><strong>目标对象（第一个参数）</strong>将被修改，并且将通过$.extend()返回。然而，如果我们想<strong>保留原对象</strong>，我们可以通过传递一个<strong>空对象</strong>作为目标对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object = $.extend(&#123;&#125;, object1, object2);</span><br></pre></td></tr></table></figure>
<p><strong>在默认情况下，通过 $.extend() 合并操作不是递归的</strong></p>
<p>如果第一个对象的属性本身是一个对象或数组，那么它将完全用第二个对象相同的key重写一个属性。这些值不会被合并。如果将  true 作为该函数的第一个参数，那么会在对象上进行递归的合并。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object1 = &#123;</span><br><span class="line">  apple: <span class="number">0</span>,</span><br><span class="line">  banana: &#123; <span class="attr">weight</span>: <span class="number">52</span>, <span class="attr">price</span>: <span class="number">100</span> &#125;,</span><br><span class="line">  cherry: <span class="number">97</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> object2 = &#123;</span><br><span class="line">  banana: &#123; <span class="attr">price</span>: <span class="number">200</span> &#125;,</span><br><span class="line">  durian: <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Merge object2 into object1</span></span><br><span class="line">$.extend( object1, object2 );</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-a764c94dbbf3113b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3)  clone( [withDataAndEvents ] )</p>
<p>深度复制<strong>所有匹配的元素集合</strong>，包括所有<strong>匹配元素</strong>、<strong>匹配元素的下级元素</strong>、<strong>文字节点</strong></p>
<ul>
<li>类似剪切的效果</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"hello"</span>&gt;Hello&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="goodbye"&gt;</span></span><br><span class="line"><span class="regexp">    Goodbye</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">$('.hello').appendTO('.goodbye')</span></span><br></pre></td></tr></table></figure>
<p>执行结果<br><img src="https://upload-images.jianshu.io/upload_images/14339384-d0f08cea21361e58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>如果需要的是复制而不是剪切，可以像下面这样写代码：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.hello'</span>).clone().appendTo(<span class="string">'.goodbye'</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-d85e2f594fd7dc1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4)  .index() / .index(selector)/ .index(element)</p>
<p>从给定集合中查找特定元素index，即获取的它所在的邻居的下标</p>
<ul>
<li><p>没参数返回第一个元素index</p>
</li>
<li><p>如果参数是DOM对象或者jQuery对象，则返回参数在集合中的index</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-5cfb35aabe288a27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
</li>
<li><p>如果参数是选择器，返回第一个匹配元素index，没有找到返回-1</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-7b3badbf1fb450e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(5)  .ready( handler )</p>
<p>当DOM准备就绪时，指定一个函数来执行。</p>
<p>虽然JavaScript提供了load事件，当页面呈现时用来执行这个事件，直到所有的东西，如图像已被完全接收前，此事件不会被触发。</p>
<p>在大多数情况下，只要DOM结构已完全加载时，脚本就可以运行。传递处理函数给.ready()方法，能保证DOM准备好后就执行这个函数，因此，这里是进行所有其它事件绑定及运行其它 jQuery 代码的最佳地方。</p>
<p>如果执行的代码需要在元素被加载之后才能使用时，（例如，取得图片的大小需要在图片被加载完后才能知道），就需要将这样的代码放到 load 事件中。</p>
<p>下面两种语法全部是等价的：</p>
<ul>
<li>$(document).ready(handler)</li>
<li>$(handler)</li>
</ul>
<p>我们经常这么使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ready'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/16/jQuery之选择器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/16/jQuery之选择器/" itemprop="url">jQuery之选择器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-16T16:07:19+08:00">
                2018-12-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、选择器"><a href="#一、选择器" class="headerlink" title="一、选择器"></a>一、选择器</h2><p>看图就会发现，jQuery选择器相当于复习CSS选择器哦，所以呀，开发者在众多js库中迅速青睐于jQuery。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-2b841af1c0fb82be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-322dad93b88a9d72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-af9e22827ca94926.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="二、常用方法"><a href="#二、常用方法" class="headerlink" title="二、常用方法"></a>二、常用方法</h2><p>(1)  .eq(index)， .get([index])</p>
<ul>
<li>获取到指定index的jQuery对象，可以用eq 方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'div'</span>).eq(<span class="number">3</span>); <span class="comment">// 获取到第四个div</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>通过类数组下标的获取方式或者get方法获取指定index的DOM对象，也就是我们说的jQuery对象转DOM对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'div'</span>)[<span class="number">3</span>];</span><br><span class="line">$(<span class="string">'div'</span>).get(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// 都是获取到第四个div</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注：<strong>get() 不写参数把所有对象转为DOM对象返回</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-8666bcb3a1eea64d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  .next([selector])，.prev([selector])</p>
<p>next 取得匹配的元素集合中<strong>每一个元素紧邻</strong>的后面<strong>同辈元素</strong>的元素集合。如果提供一个选择器，那么只有紧跟着的兄弟元素满足选择器时，才会返回此元素。</p>
<p>prev正好相反，获取元素<strong>之前</strong>的同辈元素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-64983fc7e076b542.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3)  .nextAll([selector])， .prevAll([selector])</p>
<p>nextAll获得每个匹配元素集合中每个元素<strong>所有后面的同辈元素</strong>，选择性筛选的选择器</p>
<p>prevAll与之相反，获取元素前面的同辈元素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-6d39aa09435a2e50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4)  .siblings([selectors])</p>
<p>获得匹配元素集合中<strong>每个元素的兄弟元</strong>素,可以提供一个可选的选择器</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-6258c253b1991080.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(5)  .parent([selector])</p>
<p>取得匹配元素集合中，<strong>每个元素的父元素</strong>，可以提供一个可选的选择器</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-273b7d8b67359c96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(6)  .parents([selector])</p>
<p>获得集合中<strong>每个匹配元素的祖先元素</strong>，可以提供一个可选的选择器作为参数</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-3bbe677759f45cd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(7)  .children([selector])</p>
<p>获得匹配元素集合中<strong>每个元素的子元素</strong>，选择器选择性筛选</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-f22b025c28499844.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(8)  .find([selector])</p>
<p>查找符合选择器的后代元素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-ae87bc1a22fc5d50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(9)  .filter(selector) ，.filter(function(index))</p>
<p>筛选当前结果集中<strong>符合条件的对象</strong>，参数可以是一个<strong>选择器</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-06dcf3f04a6d23c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>参数也可以是一个<strong>函数</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-a0af0ed388d14b9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(10)  .has(selector) ，.has(dom)</p>
<p>筛选匹配元素集合中的那些有<strong>相匹配的选择器</strong>或<strong>DOM元素的后代元素</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-170cfbece22bd765.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(10)  .is(selector) ， is(function(index)) ，is(dom/jqObj)</p>
<p>判断当前匹配的元素集合中的元素，是否为一个选择器，DOM元素，或者jQuery对象，如果这些元素<strong>至少一个匹配给定的参数</strong>，那么返回true</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-13eb3233c305f46b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="三、使用-jQuery-实现-多个Tab-切换效果"><a href="#三、使用-jQuery-实现-多个Tab-切换效果" class="headerlink" title="三、使用 jQuery 实现 多个Tab 切换效果"></a>三、使用 jQuery 实现 多个Tab 切换效果</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> change = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> t=$(<span class="string">'.slider'</span>).find(<span class="string">'.item'</span>);</span><br><span class="line">  t.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    $(<span class="keyword">this</span>).parents(<span class="string">'.slider'</span>).find(<span class="string">'.item'</span>).removeClass(<span class="string">'active'</span>);</span><br><span class="line">    $(<span class="keyword">this</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">    $(<span class="keyword">this</span>).parents(<span class="string">'.slider'</span>).find(<span class="string">'.box'</span>).removeClass(<span class="string">'active'</span>);</span><br><span class="line">    $(<span class="keyword">this</span>).parents(<span class="string">'.slider'</span>).find(<span class="string">'.box'</span>).eq($(<span class="keyword">this</span>).index()).addClass(<span class="string">'active'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">change();</span><br></pre></td></tr></table></figure>
<p>遇到的坑 ，页面多个tab切换时，一定要找到相应的容器，即其<strong>父元素($(this).parents(‘.slider’))</strong> ，再去找到其对应的元素，进行操作</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-1188414fc89ee450.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>如果<strong>直接元素</strong>进行操作，就会出现两个tab切换相互影响</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-801f3debcf588a0a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>更多可参考 <a href="http://jquery.com" target="_blank" rel="noopener">http://jquery.com</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/08/作用域、作用域链、闭包/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/08/作用域、作用域链、闭包/" itemprop="url">作用域、作用域链、闭包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-08T23:11:14+08:00">
                2018-12-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、作用域"><a href="#一、作用域" class="headerlink" title="一、作用域"></a>一、作用域</h1><h3 id="A、定义"><a href="#A、定义" class="headerlink" title="A、定义"></a>A、定义</h3><p>代码在运行时，各个变量、函数和对象的可访问性。换句话说，作用域决定了你的代码里的<strong>变量和其他资源</strong>在<strong>各个区域中</strong>的可见性</p>
<h3 id="B、分类"><a href="#B、分类" class="headerlink" title="B、分类"></a>B、分类</h3><h4 id="1､-全局作用域-（在函数之外的变量）"><a href="#1､-全局作用域-（在函数之外的变量）" class="headerlink" title="1､ 全局作用域  （在函数之外的变量）"></a>1､ 全局作用域  （在函数之外的变量）</h4><p>当你在文档中（document）编写 JavaScript 时，你就已经在全局作用域中了。JavaScript 文档中（document）只有一个全局作用域。定义在函数之外的变量会被保存在全局作用域中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'hello world'</span>; </span><br><span class="line"><span class="comment">//默认是全局的</span></span><br></pre></td></tr></table></figure>
<p>全局作用域里的变量能够在其他作用域中被访问和修改。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'hello world'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// 'hello world'</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name); <span class="comment">// name 可以在这里和其他地方访问</span></span><br><span class="line">&#125; </span><br><span class="line">fn(); <span class="comment">// 'hello world'</span></span><br></pre></td></tr></table></figure>
<h4 id="2､-局部作用域-（在一个函数中的变量）"><a href="#2､-局部作用域-（在一个函数中的变量）" class="headerlink" title="2､ 局部作用域  （在一个函数中的变量）"></a>2､ 局部作用域  （在一个函数中的变量）</h4><p>在函数中的变量就在局部作用域中。并且函数在每次调用时都有一个不同的作用域。这意味着同名变量可以用在不同的函数中。因为这些变量绑定在不同的函数中，拥有不同作用域，彼此之间不能访问。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局作用域</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 局部作用域</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">someOtherFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 局部作用域</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//全局作用域</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">anotherFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 局部作用域</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//全局作用域</span></span><br></pre></td></tr></table></figure>
<p>注：<strong>每个函数在调用的时候会创建一个新的作用域。</strong></p>
<h3 id="C、块语句"><a href="#C、块语句" class="headerlink" title="C、块语句"></a>C、块语句</h3><p>块级声明包括<strong>if和switch，以及for和while</strong>循环，和函数不同，它们<strong>不会创建新的作用域</strong>。在<strong>块级声明中</strong>定义的变量从属于<strong>该块所在的作用域</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;<span class="comment">// 这个 if 条件块不创建新的作用域</span></span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">'hello world'</span>; <span class="comment">// name 仍在全局范围中</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// 'hello world'</span></span><br></pre></td></tr></table></figure>
<p>ECMAScript 6 引入了let和const关键字。这些关键字可以代替var</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'hello world'</span>;</span><br><span class="line"><span class="keyword">let</span> likes = <span class="string">'Coding'</span>;</span><br><span class="line"><span class="keyword">const</span> skills = <span class="string">'Javascript and PHP'</span>;</span><br></pre></td></tr></table></figure>
<p>和var关键字不同，<strong>let</strong>和<strong>const</strong>关键字支持在块级声明中创建使用<strong>局部作用域</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;<span class="comment">// 这个 if 条件块不创建新的作用域</span></span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">'hello world'</span>;<span class="comment">// 因为 var 关键字，name 位于全局范围中</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> likes = <span class="string">'Coding'</span>; </span><br><span class="line">    <span class="comment">// 因为 let 关键字，likes在本地范围中,相当于是局部变量</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">const</span> skills = <span class="string">'JavaScript and PHP'</span>; </span><br><span class="line">    <span class="comment">// 因为 const 关键字，skills 在本地范围中，相当于是局部变量</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// 'hello world'</span></span><br><span class="line"><span class="built_in">console</span>.log(likes); </span><br><span class="line"><span class="comment">// 报错了，显示 Uncaught ReferenceError: likes is not defined</span></span><br><span class="line"><span class="comment">// 因为是likes 是局部变量，没法读取到</span></span><br><span class="line"><span class="built_in">console</span>.log(skills); </span><br><span class="line"><span class="comment">// 报错了，显示 Uncaught ReferenceError: skills is not defined</span></span><br><span class="line"><span class="comment">// 因为是skills 是局部变量，没法读取到</span></span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>(1)  一个应用中，全局作用域的生存周期与该应用相同。</p>
<p>(2)  局部作用域只在该函数调用执行期间存在。</p>
<h1 id="二、作用域链"><a href="#二、作用域链" class="headerlink" title="二、作用域链"></a>二、<strong>作用域链</strong></h1><h3 id="A、定义-1"><a href="#A、定义-1" class="headerlink" title="A、定义"></a>A、定义</h3><p>每当声明一个函数的时候会有一个独立的的作用域，遇到函数执行需要调用某一个变量的时候，需要先在当前函数的作用域下寻找。如果当前函数的作用域下找不到该值变量，就需要进入到创建该函数所在的作用域下寻找，以此往上直至找到为止。这样就形成了一条作用域链。</p>
<h3 id="B、实例"><a href="#B、实例" class="headerlink" title="B、实例"></a>B、实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fn3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">4</span></span><br><span class="line">        fn2()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> fn3</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = fn1()</span><br><span class="line">fn() <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h5 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h5><p>调用fn1()后，返回fn3，而fn3中又调用了fn2()，而fn2输出a，但是fn2中没有定义a，所以在上级作用域找a，即fn1的作用域，所以输出2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fn3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">4</span></span><br><span class="line">        fn2()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> fn3</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = fn1()</span><br><span class="line">fn() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h5 id="分析：-1"><a href="#分析：-1" class="headerlink" title="分析："></a>分析：</h5><p>调用fn1之后，return fn3，而fn3调用了fn2，fn2输出a，而fn2中没有a，所以在fn2的上级作用域中找a，所以输出全局作用域的a，即1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(a)</span><br><span class="line">    &#125;</span><br><span class="line">    fn2()</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> fn3</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = fn1()</span><br><span class="line">fn() </span><br><span class="line"><span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<h5 id="分析：-2"><a href="#分析：-2" class="headerlink" title="分析："></a>分析：</h5><p>因为变量提升,调用fn2时，在fn3的作用域下，a被声明了,但是先console.log(a),但没来得急赋值</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>(1)  函数在执行的过程中，先从自己内部找变量</p>
<p>(2)  如果找不到，再从<strong>创建当前函数所在的作用域(词法作用域)</strong>去找, 以此往上</p>
<p>(3)  注意找的是变量的当前的状态</p>
<h1 id="三、闭包"><a href="#三、闭包" class="headerlink" title="三、闭包"></a>三、闭包</h1><h3 id="A、定义-2"><a href="#A、定义-2" class="headerlink" title="A、定义"></a>A、定义</h3><p>一个函数连同它的词法作用域所在的，使用的这个变量的集合</p>
<h3 id="B、作用"><a href="#B、作用" class="headerlink" title="B、作用"></a>B、作用</h3><p>(1)  封装数据</p>
<p>(2)  暂存数据</p>
<h3 id="C、经典的闭包实例"><a href="#C、经典的闭包实例" class="headerlink" title="C、经典的闭包实例"></a>C、经典的闭包实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">car</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> speed = <span class="number">0</span> </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    speed++</span><br><span class="line">    <span class="built_in">console</span>.log(speed)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> speedUp = car() </span><br><span class="line">speedUp()   <span class="comment">//1</span></span><br><span class="line">speedUp()   <span class="comment">//2</span></span><br></pre></td></tr></table></figure>
<p><strong>分析：</strong></p>
<p>从上图有看到闭包就是有一个<strong>函数car</strong> ,函数里有<strong>一个变量speed</strong>,函数内部又声明了<strong>一个函数fn</strong>，然后<strong>return fn</strong> </p>
<p><strong>Why?</strong></p>
<p>(1)  假设函数car 里面没有fn 函数这一堆东西，当我执行 var speedUp = car(),执行完成之后，那函数car内部的局部变量就会消毁掉，那么speed 就没了，就不存在了</p>
<p>(2)  现在我们在函数car 内部声明了fn 函数，把这个函数返回出来return fn，赋值给speedUP,这个时候，因为我们的全局作用域是一直存在的，除非把当前页面给关掉，它才被消毁，所以的话，它一直存在的话，这个speedUp 就是一直存在的</p>
<p>(3)  这个speedUP是指什么呢，就是指这个fn，也就是car函数内部声明的这个fn函数</p>
<p>那这个fn函数就是一直存在,换句话说，这个car 函数作用域内的东西就无法被销毁，也就是变量speed和fn函数无法销毁,因为它里面有东西被人用，其实是和浏览器的垃圾回收机制是相关的</p>
<p>(4)  当我们去执行speedUp（）时，实际上就是去执行fn函数,然后fn函数内部是没有声明这个speed变量的，它会从上一级的词法作用域去找，也就是这个函数fn,声明时所在的作用域，也就是car函数内部,  最后找到这个speed,然后把这个值speed++ ,即这个speed 值加1,然后再次调用这个函数，所以又在之前的值基础上，再加1</p>
<p>换句话说，正常情况下，car 执行完后，speed变量就消失了，就没有了，我们也无法去获取，但是现在在函数car内部，又返回出一个函数fn,然后函数fn内部又使用这个speed, 就导致创建了一个闭包</p>
<p><strong>那什么是个闭包呢</strong>？</p>
<p>就是这个函数fn连同它词法作用域下所在的使用的这个变量speed的集合。也就是变量speed 和 函数fn 加在一起，就是一个闭包</p>
<p><strong>闭包有什么用呢？我们直观的看一看</strong></p>
<p>(1)  当我调用speedUp()时，fn函数内的speed 的值会加1,换句话说这个变量是不是就暂存下来了，我们无法去直接访问这个变量speed,但是我们可以去操作它，而且呢，它会暂存起来，不会被销毁掉</p>
<p>(2)  第二个就是封装数据，就是把speed 给封装起来</p>
<p>注：如果<strong>不执行return fn</strong>的话，那car函数 执行完之后，fn函数内的所有的局部变量都会销毁掉,销毁掉就什么都没有了，什么都没有了就不存在<strong>有没有闭包了</strong></p>
<h3 id="D、其他实例"><a href="#D、其他实例" class="headerlink" title="D、其他实例"></a>D、其他实例</h3><p>理解了下面几个实例，你就能熟练理解运用闭包了</p>
<h4 id="例1-如下代码输出多少"><a href="#例1-如下代码输出多少" class="headerlink" title="例1 如下代码输出多少"></a>例1 如下代码输出多少</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fnArr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  fnArr[i] =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]()) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p><strong>分析：</strong></p>
<p>有一个<strong>空数组 fnArr,</strong>然后我们去<strong>遍历这个数组</strong>,遍历时侯给这个数组<strong>去赋值</strong>,数组的每一个值是对应<strong>匿名函数</strong>，然后里面有一个 <strong>return i</strong>，最后是console.log( fnArr[3] () ) ，其中 fnArr[3] () 是立即执行表达式, 相当于会立即执行这个函数， 得到最终的值</p>
<p><strong>是3吗，不是，为什么呢？</strong></p>
<p>(1)   因为我们在做遍历的时侯，就只有去赋值了，没有去执行return i 的，那这就是一个函数，相当于fnArr里面对应的这么几个函数名</p>
<p>(2)  当去执行 fnArr[3] () 的时候，就会去执行对应的函数，然后return i，此时i 是多少呢？</p>
<p><strong>那这个函数内部没有i ,那从哪去找呢？</strong></p>
<p>从这个函数创建它的词法作用域去找, 它的词法作用域，说白了，不就是我们的全局作用域吗</p>
<p>因为 <strong>for 循环</strong>，并不是一个函数，所以这里面<strong>没有作用域</strong>，自然for 下面的function 词法作用域是全局作用域</p>
<p><strong>那全局作用域里面的 i 是多少呢</strong>？</p>
<p>此时这里面因为已经执行完了，for循环完成之后  ，这个 i 变成 10 啦</p>
<p>所以最终找到的 i 就是 10 ,输出结果是 10</p>
<h5 id="从控制台这里，也能看出源由啦"><a href="#从控制台这里，也能看出源由啦" class="headerlink" title="从控制台这里，也能看出源由啦"></a>从控制台这里，也能看出源由啦</h5><p>​<img src="https://upload-images.jianshu.io/upload_images/14339384-f42162b2f302a9b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>图中可以看出 fnArr ，对应是<strong>一个数组</strong>,数组里面都是函数,函数里面有一个Scopes , 对应的是什么呢？<br>对应的是Global全局作用域，为什么呢?  前面我们说了<strong>作用域链</strong></p>
<p>(1) 当我们去使用一个变量时侯，会从函数内部去找，也就是它的函数内部的一个活动对象</p>
<p>(2) 如果找不到的话，再从它的词法作用域去找。它的词法作用域是什么呢？<br>就是这个函数所创建它的所得的作用域 </p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>(1) 打开fnArr函数，会看到Scopes<br>其实这个函数在执行过程中，先从自已里面找，找不到的话，再从Scopes里面找，<br>它的Scopes 是谁呢，Scopes就是Global</p>
<p>(2) 如果嵌套几层的话，它的Scopes下面 还有一个，那其实这就是它的一个作用域链</p>
<p>所以当我们执行fnArr[3] 的时侯，从内部找 i , 找不到的话，再从Scopes里面找, 从 window里找 ,对不对，执行它 fnArr[3] ，得到是10，因为i 最终是 10</p>
<h5 id="如果要输出3-的话，可以这么改"><a href="#如果要输出3-的话，可以这么改" class="headerlink" title="如果要输出3 的话，可以这么改"></a>如果要输出3 的话，可以这么改</h5><p>方法1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fnArr = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i ++) &#123;</span><br><span class="line">  fnArr[i] =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log( fnArr[<span class="number">3</span>]() ) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h5 id="分析：-3"><a href="#分析：-3" class="headerlink" title="分析："></a>分析：</h5><p>(1) 首先 fnArr[3] () 输出什么，哎呀，我有点看不懂。那我们来变装下吧！<br>那假设这个for 循环没有10层，只有2层, 代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fnArr = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++) &#123;</span><br><span class="line">  fnArr[i] =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]())</span><br></pre></td></tr></table></figure>
<p>这样子的话，只有2层，我们的for 循环也可以去掉了，相当于执行2次，代码变成了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fnArr = []</span><br><span class="line">fnArr[0] =  (function(j)&#123;</span><br><span class="line">    return function()&#123;</span><br><span class="line">      return j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(0)</span><br><span class="line">fnArr[1] =  (function(j)&#123;</span><br><span class="line">    return function()&#123;</span><br><span class="line">      return j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(1)</span><br><span class="line">fnArr[1]()</span><br></pre></td></tr></table></figure>
<p>一个数组里面有2个值，那我还不如直接写2个值，代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">var</span> b =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(<span class="number">1</span>) </span><br><span class="line">b()</span><br></pre></td></tr></table></figure>
<p>这个时候我问你，b执行的结果是多少？<br>从上面代码看，b 等于 一个立即执行函数表达式，哈哈，它又相当于什么呢，</p>
<p>那即然它是匿名函数，我可以给它加一个函数名fn2, 然后给a也加一个函数名fn1 ,这下代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a =  (<span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">var</span> b =  (<span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(<span class="number">1</span>) <span class="comment">//声明了一个函数，然后去执行它</span></span><br><span class="line">b()</span><br></pre></td></tr></table></figure>
<p>如果这样子的话，我还不如这样子改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = fn1(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">var</span> b = fn2(<span class="number">1</span>) <span class="comment">// 相当于j 等于1</span></span><br><span class="line">a()</span><br><span class="line">b()</span><br></pre></td></tr></table></figure>
<p>fn2(1)去执行这个函数的结果，相当于j 等于1 ，也就是说执行这个函数的结果,就是return了一个函数，换句话说 b 的值，就是这里面的函数</p>
<p>当去执行b的时侯，也就是当去执行这个函数的时候 ，return j ,j 是多少呢？<br>那j 在哪里呢?是不是在函数内部 b 里面 ，函数内部没有j ,没有j的话，就从哪里找呢<br>就从这个函数<br>function (){<br>​    return j<br>}<br>所在的词法作用域去找，也就是它声明的地方(fn2函数内部),那代码可以变成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = fn1(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">var</span> b = fn2(<span class="number">1</span>)</span><br><span class="line">a()</span><br><span class="line">b()</span><br></pre></td></tr></table></figure>
<p>这个时侯, b 就等于 f ,那执行b的时候， <code>return j</code>，j 在哪里呢，函数f里面没有，那它会去它的词法作用域去找，即fn2这个函数内部去找,这个内部有没j 呢，有，因为在调用fn2时，传递了一个j ,相当于<br><code>var j = arguments[0]</code>, 也就是1 , 所以输出了1</p>
<p>上面部分代码变成了，其他没变</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> j = <span class="built_in">arguments</span>[<span class="number">0</span>]  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = fn2(<span class="number">1</span>)</span><br><span class="line">b()</span><br></pre></td></tr></table></figure>
<p>方法2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fnArr = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i ++) &#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    fnArr[i] =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> i</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log( fnArr[<span class="number">3</span>]() ) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>还记得那个经典闭包实例吧，我们可以演变一下</p>
<p><strong>//改前</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">car</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> speed = <span class="number">0</span> </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    speed++</span><br><span class="line">    <span class="built_in">console</span>.log(speed)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> speedUp = car()</span><br></pre></td></tr></table></figure>
<p><strong>//改后</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">car</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> speed = <span class="number">0</span> </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    speed++</span><br><span class="line">    <span class="built_in">console</span>.log(speed)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> speedUp = car()</span><br></pre></td></tr></table></figure>
<h5 id="分析：-4"><a href="#分析：-4" class="headerlink" title="分析："></a>分析：</h5><p>假设car 有一个形参 speed ,那是不是代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">car</span>(<span class="params"></span>)</span>&#123;<span class="comment">//arguments 对象可以在函数体内部读取所有参数</span></span><br><span class="line">  <span class="keyword">var</span> speed = <span class="built_in">arguments</span>[<span class="number">0</span>] <span class="comment">//arguments[0]就是第一个参数speed</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    speed++</span><br><span class="line">    <span class="built_in">console</span>.log(speed)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> speedUp = car(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>那现在是声明了一个函数car，去执行它car(3)<br>那这样子，我可以把一个函数写过来，代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> speedUp = (<span class="function"><span class="keyword">function</span> <span class="title">car</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> speed = <span class="built_in">arguments</span>[<span class="number">0</span>] </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    speed++</span><br><span class="line">    <span class="built_in">console</span>.log(speed)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>即然这样子写的话，那个函数名car 也可以去掉，那代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> speedUp = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> speed = <span class="built_in">arguments</span>[<span class="number">0</span>] </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    speed++</span><br><span class="line">    <span class="built_in">console</span>.log(speed)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>现在不就变成了一个立即执行函数表达式了<br>所以说<strong>立即执行表达式</strong>里面如果有<strong>return</strong>的话，那就是生成了<strong>闭包</strong></p>
<p>和刚刚最原始的闭包，经过一个个的演化，替换，得到的效果是一模一样的</p>
<p>和上面的这个</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b =  (<span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line"> &#125;)(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>是不是一样的</p>
<p>哎呀，累死我啦！还没完！</p>
<p>回到最上面的这段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fnArr = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i ++) &#123;</span><br><span class="line">  fnArr[i] =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fnArr[<span class="number">3</span>]())</span><br></pre></td></tr></table></figure>
<p>按照这种方式去演变，这里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fnArr[i] =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>就生成了10个闭包,这里面有10个函数,然后每个闭包里暂存了一个变量,代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fnArr[i] =  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = <span class="built_in">arguments</span>[<span class="number">0</span>] <span class="comment">//暂存的变量就在这里</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> j</span><br><span class="line">    &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>也就是说在一开始的时侯，传递的 0,1,2,…9，然后这里面有10 个闭包，存了10个不一样的值，所以你下次去执行这个函数的时侯, 执行对应的函数的时候，它会从上面去找 j ，也就找到自已对应的词法作用域下面的这个值 ，也就是这里面的一个临时变量 var j = arguments[0]</p>
<h4 id="例2-封装一个-Car-对象"><a href="#例2-封装一个-Car-对象" class="headerlink" title="例2 封装一个 Car 对象"></a>例2 封装一个 Car 对象</h4><p>通过接口去操作一些数据，不能直接访问这些数据，为了数据有一定的安全性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> car = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> speed = <span class="number">0</span>;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">       speed = s</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> speed</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">speedUp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      speed++</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">speedDown</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      speed--</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">      set: set,</span><br><span class="line">      get: get,</span><br><span class="line">      speedUp: speedUp,</span><br><span class="line">      speedDown: speedDown</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)()</span><br><span class="line">car.set(<span class="number">30</span>)</span><br><span class="line">car.get() <span class="comment">//30</span></span><br><span class="line">car.speedUp()</span><br><span class="line">car.get() <span class="comment">//31</span></span><br><span class="line">car.speedDown()</span><br><span class="line">car.get()  <span class="comment">//30</span></span><br></pre></td></tr></table></figure>
<h5 id="分析：-5"><a href="#分析：-5" class="headerlink" title="分析："></a>分析：</h5><p>car是一个立刻执行的函数表达式中return出来的结果。</p>
<p>(1) return出来是一个对象，有四个属性 <strong>set、get、speedUp、speedDown</strong>，四个属性对应的是一个值，即四个函数<strong>set、get、speedUp、speedDown</strong>。这四个函数就用于操作speed的值。</p>
<p>(2) 为什么得不到释放呢？</p>
<p>a、这导致了car永远得不到释放，因为它是我们的全局变量</p>
<p>b、car 得不到释放，那return对象也得不到释放，因为这个对象是引用类型,它们本质上是同一个东西</p>
<p>c、return对象得不到释放，那里面的属性值也没法释放</p>
<p>d、属性值得不到释放，对应的函数也无法释放，那speed变量自然也释放不了，就生成了一个闭包</p>
<h5 id="例3-如下代码输出多少？如何连续输出-0-1-2-3-4"><a href="#例3-如下代码输出多少？如何连续输出-0-1-2-3-4" class="headerlink" title="例3 如下代码输出多少？如何连续输出 0,1,2,3,4"></a>例3 如下代码输出多少？如何连续输出 0,1,2,3,4</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'delayer:'</span> + i )</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;<span class="comment">// 连续输出5个 delayer:5</span></span><br></pre></td></tr></table></figure>
<h5 id="分析：-6"><a href="#分析：-6" class="headerlink" title="分析："></a>分析：</h5><p>setTimeout 会把当前的执行（也就是函数的代码）添加到任务队列里面，相当于设置了5个计时器，并没有开始,当5个设置完成之后,这个时侯 i 已经变成 5 啦</p>
<p>此刻才去执行任务队列里面的代码，然后一个个去执行setTimeout 里面的函数 ，当执行它的时候，开始找 i 的值，for循环已经执行完了，i 已经变成5 啦，所以连续输出5个5</p>
<p><strong>改后:</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'delayer:'</span> + j )</span><br><span class="line">    &#125;, <span class="number">0</span>)    </span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以简化下代码，for 循环 变成 2 时，代码变成了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = <span class="built_in">arguments</span>[<span class="number">0</span>]</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'delayer:'</span> + j )</span><br><span class="line">    &#125;, <span class="number">0</span>) </span><br><span class="line">&#125;</span><br><span class="line">fn1(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = <span class="built_in">arguments</span>[<span class="number">0</span>]</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'delayer:'</span> + j )</span><br><span class="line">    &#125;, <span class="number">0</span>) </span><br><span class="line">&#125;</span><br><span class="line">fn2(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>通过一个<strong>立刻执行的函数表达式</strong>，生成一个闭包。因为for循环不会产生一个作用域，所以可以不用return。当然用return也可以</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">  setTimeout((<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'delayer:'</span> + j )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;(i)), <span class="number">0</span>)    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相当于 setTimeout 第一层带参数 j 函数会立即去执行，并没有延时,执行过程中，传递了 i , 其实得到了return 出来的函数结果, setTimeout 能用这个函数，用的过程中，如果用到这个变量 j，就相当于那个中间夹了一个临时变量<code>var j = arguments[0]</code>,存进去了，那下次要用过这个变量j ，它就会从这里面找。</p>
<p>也就是说把 i = 0 ,变成 j 放到那里, i = 1,变成 j 放到那里 ,依次类推，到4</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">  setTimeout((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> j = <span class="built_in">arguments</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'delayer:'</span> + j )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;(i)), <span class="number">0</span>)    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="例4"><a href="#例4" class="headerlink" title="例4"></a>例4</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCounter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count++</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = makeCounter()</span><br><span class="line"><span class="comment">// 相当于 return 函数 返回的值 赋值给 counter</span></span><br><span class="line"><span class="keyword">var</span> counter2 = makeCounter();</span><br><span class="line"><span class="comment">// 相当于把第二次执行 return 函数 返回的值给 counter 也就是把第一次执行的结果 count +1</span></span><br><span class="line"><span class="built_in">console</span>.log( counter() ) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log( counter() ) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( counter2() ) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log( counter2() ) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p><strong>分析：</strong> </p>
<p>当我们第一次执行 makeCounter()时，相当于有了作用域 ，有了一个活动对象count,再次执行makeCounter，又有了一个新的作用域，有一个新的活动对象count, 所以呀，它们是独立的。切记！</p>
<h4 id="例5-补全代码，实现数组按姓名、年纪、任意字段排序"><a href="#例5-补全代码，实现数组按姓名、年纪、任意字段排序" class="headerlink" title="例5 补全代码，实现数组按姓名、年纪、任意字段排序"></a>例5 补全代码，实现数组按姓名、年纪、任意字段排序</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">"John"</span>, <span class="attr">age</span>: <span class="number">20</span>, <span class="attr">company</span>: <span class="string">"Baidu"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">"Pete"</span>, <span class="attr">age</span>: <span class="number">18</span>, <span class="attr">company</span>: <span class="string">"Alibaba"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">"Ann"</span>, <span class="attr">age</span>: <span class="number">19</span>, <span class="attr">company</span>: <span class="string">"Tecent"</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">users.sort(byName) </span><br><span class="line">users.sort(byAge)</span><br><span class="line">users.sort(byField(<span class="string">'company'</span>))</span><br></pre></td></tr></table></figure>
<p><strong>补全后代码变成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">byName</span>(<span class="params">user1, user2</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> user1.name &gt; user2.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">byAge</span> (<span class="params">user1, user2</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> user1.age &gt; user2.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">byFeild</span>(<span class="params">field</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">user1, user2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> user1[field] &gt; user2[field]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">users.sort(byField(<span class="string">'company'</span>))</span><br></pre></td></tr></table></figure>
<p>注：sort 排序 后面必须是<strong>一个函数</strong>，所以需要返回一个参数。</p>
<h4 id="例6-写一个-sum-函数，实现如下调用方式"><a href="#例6-写一个-sum-函数，实现如下调用方式" class="headerlink" title="例6 写一个 sum 函数，实现如下调用方式"></a><strong>例6 写一个 sum 函数，实现如下调用方式</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log( sum(<span class="number">1</span>)(<span class="number">2</span>) ) <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log( sum(<span class="number">5</span>)(<span class="number">-1</span>) ) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p><strong>分析：</strong></p>
<p>(1)  sum(1) 后面跟着一个() ,表示一个没有执行的函数，其中sum(1) 是一个函数名,相当于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2)  sum(1) (2) 表示sum(1) 传递了一个参数2 ,返回一个东西,也就是相当于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>)</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">1</span>)(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>(3) 最后我们得到a+b的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结：-1"><a href="#总结：-1" class="headerlink" title="总结："></a>总结：</h3><blockquote>
<p>函数柯里化-只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数</p>
</blockquote>
<p>可看看方方老师的文章 <a href="https://zhuanlan.zhihu.com/p/22486908" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/22486908</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/跨域(JSONP)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/跨域(JSONP)/" itemprop="url">跨域</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T14:32:10+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、同源策略-Same-origin-Policy"><a href="#一、同源策略-Same-origin-Policy" class="headerlink" title="一、同源策略(Same origin Policy)"></a>一、同源策略(Same origin Policy)</h2><p>浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。</p>
<h3 id="1、同源-本域"><a href="#1、同源-本域" class="headerlink" title="1、同源(本域)"></a>1、同源(本域)</h3><p>所谓“同源”指的是”三个相同“。相同的域名、端口和协议，这三个相同的话就视为同一个域，本域下的JS脚本只能读写本域下的数据资源，无法访问其它域的资源。</p>
<ul>
<li>协议相同 (都是http或者https)</li>
<li>域名相同 (都是<a href="http://jirengu.com/a" target="_blank" rel="noopener">http://jirengu.com/a</a> 和<a href="http://jirengu.com/b" target="_blank" rel="noopener">http://jirengu.com/b</a>)</li>
<li>端口相同（都是80端口，如果没有写端口，默认是80端口）</li>
</ul>
<p>举个例子</p>
<ul>
<li>同源情况：</li>
</ul>
<p><a href="http://jirengu.com/a/b.js" target="_blank" rel="noopener">http://jirengu.com/a/b.js</a> 和 <a href="http://jirengu.com/index.php" target="_blank" rel="noopener">http://jirengu.com/index.php</a></p>
<ul>
<li><p>不同源情况：</p>
<p><a href="http://jirengu.com/main.js&gt;" target="_blank" rel="noopener">http://jirengu.com/main.js&gt;</a> 和 <a href="https://jirengu.com/a.php" target="_blank" rel="noopener">https://jirengu.com/a.php</a> (协议不同)</p>
<p><a href="http://jirengu.com/main.js&gt;" target="_blank" rel="noopener">http://jirengu.com/main.js&gt;</a> 和 <a href="http://bbs.jirengu.com/a.php" target="_blank" rel="noopener">http://bbs.jirengu.com/a.php</a> (域名不同，域名必须完全相同才可以)</p>
<p><a href="http://jiengu.com/main.js" target="_blank" rel="noopener">http://jiengu.com/main.js</a> 和 <a href="http://jirengu.com:8080/a.php" target="_blank" rel="noopener">http://jirengu.com:8080/a.php</a> (端口不同,第一个是80)</p>
</li>
</ul>
<h3 id="2、Ajax-跨域报错实例"><a href="#2、Ajax-跨域报错实例" class="headerlink" title="2、Ajax 跨域报错实例"></a>2、Ajax 跨域报错实例</h3><p>（1）修改host文件：给host文件里添加两条记录，方便跨域操作</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-75febd5f566fec3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>上图意思是访问 a.com 或是 b.com 相当于访问本机, 可以实现一个场景：浏览器是a.com，而接口是b.com,虽说最终对应的是本机，但是域名不一样</p>
<p>（2）建一个index.html文件，获取数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;hello world&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="regexp">  xhr.open('GET','http:/</span><span class="regexp">/localhost:8080/g</span>etWeather<span class="string">', true)</span></span><br><span class="line"><span class="string">  xhr.send()</span></span><br><span class="line"><span class="string">  xhr.onload = function()&#123;</span></span><br><span class="line"><span class="string">    console.log(xhr.responseText)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）建一个server.js文件，实现静态文件、动态路由功能</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> pathObj = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (pathObj.pathname) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/getWeather'</span>:</span><br><span class="line">      res.end(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">beijing</span>: <span class="string">'sunny'</span>&#125;))</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fs.readFile(path.join(__dirname, pathObj.pathname), <span class="function"><span class="keyword">function</span>(<span class="params">e, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(e)&#123;</span><br><span class="line">          res.writeHead(<span class="number">404</span>, <span class="string">'not found'</span>)</span><br><span class="line">          res.end(<span class="string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          res.end(data)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;).listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>（4）执行结果</p>
<p>   打开终端，cd 到当前文件夹，然后输入node server.js，启动静态服务器</p>
<p>   A、浏览器地址栏输入<code>localhost:8080/index.html</code> ,获取到了数据</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-df7c327bc97219d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>B、浏览器地址改为127.0.0.1:8080/index.html,就报错啦，因为当前域名和请求域名不一样</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-f6eba15f2a427fc1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>C、如果浏览器改成a.com或是b.com 也是会报错的，就算它们都是指向同一个本机</p>
<p><strong>总结一下：</strong>只有在请求域名和当前域名相同的情况下，才能获取数据，才不会报错。</p>
<p><strong>注：</strong>跨域的资源内嵌是被允许的，<strong>对于当前页面来说页面存放的 JS 文件的域不重要，重要的是加载该 JS 页面所在什么域</strong></p>
<h2 id="二、跨域"><a href="#二、跨域" class="headerlink" title="二、跨域"></a>二、跨域</h2><p>解决同源策略带来的不便，突破同源策略的限制去获取不同源之间的数据信息或者进行不同源之间的信息传递。</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><h4 id="1､-JSONP"><a href="#1､-JSONP" class="headerlink" title="1､ JSONP"></a>1､ JSONP</h4><p>HTML 中 script 标签可以加载其他域下的js，比如我们经常引入一个其他域下线上cdn的jQuery。</p>
<p>可以这样子实现从其他域下获取数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"http://api.jirengu.com/weather.php"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这时候会向天气接口发送请求获取数据，获取数据后做为 js 来执行。 但这里有个问题， 数据是 JSON 格式的数据，直接作为 JS 运行的话,如何去得到这个数据来操作呢？</p>
<p>此时需要后端的配合，因为后端的接口需要根据约定的参数获取回调函数名，然后跟返回数据进行拼接，最后进行响应</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"http://api.jirengu.com/weather.php?callback=showData"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这个请求到达后端后，后端会去解析callback这个参数获取到字符串showData，在发送数据做如下处理：</p>
<p>之前后端返回数据： {“city”: “hangzhou”, “weather”: “晴天”} </p>
<p>现在后端返回数据： showData({“city”: “hangzhou”, “weather”: “晴天”}) </p>
<p>前端script标签在加载数据后会把 「showData({“city”: “hangzhou”, “weather”: “晴天”})」做为 js 来执行。</p>
<p>这实际上就是调用showData这个函数，同时参数是 {“city”: “hangzhou”, “weather”: “晴天”}。</p>
<p> 当然前端提前在页面定义好showData这个全局函数，在函数内部处理参数即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showData</span>(<span class="params">ret</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(ret);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="http:/</span><span class="regexp">/api.jirengu.com/</span>weather.php?callback=showData<span class="string">"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="总结一下："><a href="#总结一下：" class="headerlink" title="总结一下："></a>总结一下：</h5><p>（1）JSONP是通过 script 标签加载数据的方式去获取数据当做 JS 代码来执行 </p>
<p>（2）提前在页面上声明一个函数，函数名通过接口传参的方式传给后台，后台解析到函数名后在原始数据上「包裹」这个函数名，发送给前端。</p>
<p>换句话说，JSONP 需要对应接口的后端的配合才能实现</p>
<p>举个例子</p>
<p> server.js 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pathObj = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (pathObj.pathname) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/getNews'</span>:</span><br><span class="line">      <span class="keyword">var</span> news = [</span><br><span class="line">        <span class="string">"第11日前瞻：中国冲击4金 博尔特再战200米羽球"</span>,</span><br><span class="line">        <span class="string">"正直播柴飚/洪炜出战 男双力争会师决赛"</span>,</span><br><span class="line">        <span class="string">"女排将死磕巴西！郎平安排男陪练模仿对方核心"</span></span><br><span class="line">        ]</span><br><span class="line">      res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/json; charset=utf-8'</span>)</span><br><span class="line">      <span class="keyword">if</span>(pathObj.query.callback)&#123;</span><br><span class="line">        res.end(pathObj.query.callback + <span class="string">'('</span> + <span class="built_in">JSON</span>.stringify(news) + <span class="string">')'</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="built_in">JSON</span>.stringify(news))</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fs.readFile(path.join(__dirname, pathObj.pathname), <span class="function"><span class="keyword">function</span>(<span class="params">e, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(e)&#123;</span><br><span class="line">          res.writeHead(<span class="number">404</span>, <span class="string">'not found'</span>)</span><br><span class="line">          res.end(<span class="string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          res.end(data)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;).listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>html文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"news"</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button class="show"&gt;show news&lt;/</span>button&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  $('.show').addEventListener('click', function()&#123;</span></span><br><span class="line"><span class="regexp">    var script = document.createElement('script');</span></span><br><span class="line"><span class="regexp">    script.src = 'http:/</span><span class="regexp">/127.0.0.1:8080/g</span>etNews?callback=appendHtml<span class="string">';</span></span><br><span class="line"><span class="string">    document.head.appendChild(script); </span></span><br><span class="line"><span class="string">   //script标签放到head上，并向http://127.0.0.1:8080/getNews?callback=appendHtml发请求,获取到		并执行</span></span><br><span class="line"><span class="string">    document.head.removeChild(script);// 为了显示好看，加上移除这句</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  function appendHtml(news)&#123;</span></span><br><span class="line"><span class="string">    var html = '</span><span class="string">';</span></span><br><span class="line"><span class="string">    for( var i=0; i&lt;news.length; i++)&#123;</span></span><br><span class="line"><span class="string">      html += '</span>&lt;li&gt;<span class="string">' + news[i] + '</span>&lt;<span class="regexp">/li&gt;';</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    console.log(html);</span></span><br><span class="line"><span class="regexp">    $('.news').innerHTML = html;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  function $(id)&#123;</span></span><br><span class="line"><span class="regexp">    return document.querySelector(id);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>打开终端，cd 到当前文件夹，然后输入node server.js，启动静态服务器</p>
<p>显示结果：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-7bf1c56c799ad488.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>图中Request URL :<a href="http://127.0.0.1:8080/getNews?callback=appendHtml" target="_blank" rel="noopener">http://127.0.0.1:8080/getNews?callback=appendHtml</a> 会向浏览器发请求，得到数据,然后当成 js 去执行，因为页面上已经有了appendHtml函数,然后去执行这个函数，把appendHtml 括号里的内容作为参数传递进去</p>
<p> <img src="https://upload-images.jianshu.io/upload_images/9375265-03cd499582ca046f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="2、CORS"><a href="#2、CORS" class="headerlink" title="2、CORS"></a>2、CORS</h4><p>全称是跨域资源共享（Cross-Origin Resource Sharing），是一种 ajax 跨域请求资源的方式，支持现代浏览器，IE支持10以上。</p>
<p>实现方式：</p>
<p>当你使用 XMLHttpRequest 发送请求时，浏览器发现该请求不符合同源策略，会给该请求加一个请求头：Origin，后台进行一系列处理：</p>
<p>（1）如果确定接受请求则在返回结果中加入一个响应头：Access-Control-Allow-Origin; 浏览器判断该相应头中是否包含 Origin 的值。</p>
<p>（2）如果有则浏览器会处理响应，我们就可以拿到响应数据。</p>
<p>（3）如果不包含浏览器直接驳回，这时我们无法拿到响应数据。</p>
<p>所以 CORS 的表象是让你觉得它与同源的 ajax 请求没啥区别，代码完全一样。</p>
<p>举个例子</p>
<p>server.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pathObj = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (pathObj.pathname) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/getNews'</span>:</span><br><span class="line">      <span class="keyword">var</span> news = [</span><br><span class="line">        <span class="string">"第11日前瞻：中国冲击4金 博尔特再战200米羽球"</span>,</span><br><span class="line">        <span class="string">"正直播柴飚/洪炜出战 男双力争会师决赛"</span>,</span><br><span class="line">        <span class="string">"女排将死磕巴西！郎平安排男陪练模仿对方核心"</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">      res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>,<span class="string">'http://localhost:8080'</span>)</span><br><span class="line">      <span class="comment">//访问控制允许的域 http://localhost:8080</span></span><br><span class="line">      <span class="comment">//res.setHeader('Access-Control-Allow-Origin','*')</span></span><br><span class="line">      res.end(<span class="built_in">JSON</span>.stringify(news))</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fs.readFile(path.join(__dirname, pathObj.pathname), <span class="function"><span class="keyword">function</span>(<span class="params">e, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(e)&#123;</span><br><span class="line">          res.writeHead(<span class="number">404</span>, <span class="string">'not found'</span>)</span><br><span class="line">          res.end(<span class="string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          res.end(data)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;).listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>index.html文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container"</span>&gt;</span><br><span class="line">    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"news"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button class="show"&gt;show news&lt;/</span>button&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  $('.show').addEventListener('click', function()&#123;</span></span><br><span class="line"><span class="regexp">    var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="regexp">    xhr.open('GET', 'http:/</span><span class="regexp">/127.0.0.1:8080/g</span>etNews<span class="string">', true)</span></span><br><span class="line"><span class="string">    xhr.send()</span></span><br><span class="line"><span class="string">    xhr.onload = function()&#123;</span></span><br><span class="line"><span class="string">      appendHtml(JSON.parse(xhr.responseText))</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  function appendHtml(news)&#123;</span></span><br><span class="line"><span class="string">    var html = '</span><span class="string">'</span></span><br><span class="line"><span class="string">    for( var i=0; i&lt;news.length; i++)&#123;</span></span><br><span class="line"><span class="string">      html += '</span>&lt;li&gt;<span class="string">' + news[i] + '</span>&lt;<span class="regexp">/li&gt;'</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    $('.news').innerHTML = html</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  function $(selector)&#123;</span></span><br><span class="line"><span class="regexp">    return document.querySelector(selector)</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>显示结果</p>
<p>（1）输入<a href="http://127.0.0.1:8080/index.html" target="_blank" rel="noopener">http://127.0.0.1:8080/index.html</a> 发送请求时，不需要跨域，请求头什么都没有</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-c3e9765beec2056d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>（2）输入<a href="http://localhost:8080/index.html，此时出现跨域" target="_blank" rel="noopener">http://localhost:8080/index.html，此时出现跨域</a></p>
<p>​    响应头有Access-Control-Allow-Origin: <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:8080</p>
<p>​    请求头有Origin: <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:8080</p>
<p>​    表示两者相同，可以获取数据</p>
<p><img src="/Users/laoda/Library/Application Support/typora-user-images/image-20181207232056296.png" alt="image-20181207232056296"></p>
<p>（3）输入<a href="http://a.com:8080/index.html" target="_blank" rel="noopener">http://a.com:8080/index.html</a> 时，就报错啦</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-65546f9c31b61073.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>因为服务端不允许a.com 获取数据</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-9dd2bb48ed0daa28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>响应头 Access-Control-Allow-Origin 设置为星号，表示同意任意跨源请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: <span class="string">'*'</span></span><br></pre></td></tr></table></figure>
<p>那么<a href="http://a.com:8080/index.html就能获取数据啦" target="_blank" rel="noopener">http://a.com:8080/index.html就能获取数据啦</a>!</p>
<h4 id="3､降域"><a href="#3､降域" class="headerlink" title="3､降域"></a>3､降域</h4><h5 id="（1）iframe-不同源"><a href="#（1）iframe-不同源" class="headerlink" title="（1）iframe 不同源"></a>（1）iframe 不同源</h5><p>iframe里面加载的页面，它的域名,如果和我当前的是属于不同域，虽然iframe里面的东西可以加载，但外部的js无法去获取或操作的。<br>也就是说，只有在相同域名下的iframe，才可以去访问里面的东西</p>
<p>举个例子</p>
<p>a.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style&gt;</span></span><br><span class="line"><span class="regexp">	.ct&#123;</span></span><br><span class="line"><span class="regexp">		width: 910px;</span></span><br><span class="line"><span class="regexp">		margin: 0 auto;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	.main&#123;</span></span><br><span class="line"><span class="regexp">		float: left;</span></span><br><span class="line"><span class="regexp">		width: 450px;</span></span><br><span class="line"><span class="regexp">		height: 300px;</span></span><br><span class="line"><span class="regexp">		border: 1px solid #ccc;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	.main input&#123;</span></span><br><span class="line"><span class="regexp">		margin: 20px;</span></span><br><span class="line"><span class="regexp">		width: 200px;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	.iframe&#123;</span></span><br><span class="line"><span class="regexp">		float: right;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	iframe&#123;</span></span><br><span class="line"><span class="regexp">		width: 450px;</span></span><br><span class="line"><span class="regexp">		height: 300px;</span></span><br><span class="line"><span class="regexp">		border: 1px dashed #ccc;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ct"</span>&gt;</span><br><span class="line">	&lt;h1&gt;使用降域实现跨域&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">	&lt;div class="main"&gt;</span></span><br><span class="line"><span class="regexp">		&lt;input type="text" placeholder="http:/</span><span class="regexp">/a.com:8080/</span>a.html<span class="string">"&gt;</span></span><br><span class="line"><span class="string">	&lt;/div&gt;</span></span><br><span class="line"><span class="string">	&lt;iframe src="</span>http:<span class="comment">//b.com:8080/b.html" frameborder="0"&gt;&lt;/iframe&gt;</span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/URL  http:/</span><span class="regexp">/a.jrg.com:8080/</span>a.html</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.main input'</span>).addEventListener(<span class="string">'input'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">		<span class="built_in">window</span>.frames[<span class="number">0</span>].document.querySelector(<span class="string">'input'</span>).value = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">"jrg.com"</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>b.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;style&gt;</span></span><br><span class="line"><span class="regexp">	html,body&#123;</span></span><br><span class="line"><span class="regexp">		margin: 0;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	input&#123;</span></span><br><span class="line"><span class="regexp">		margin: 20px;</span></span><br><span class="line"><span class="regexp">		width: 200px;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input id = <span class="string">"input"</span> type=<span class="string">"text"</span> placeholder=<span class="string">"http://b.jrg.com:8080/b.html"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// URL http://b.jrg.com:8080/b.html</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'#input'</span>).addEventListener(<span class="string">'input'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">window</span>.parent.document.querySelector(<span class="string">'input'</span>).value = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">'jrg.com'</span>;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>同样先是host 文件添加两条记录</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-1635c5a8acdb9d3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>打开终端，cd 到当前文件夹，启动http-server</p>
<p>用a.com 打开a.html, <a href="http://a.com:8080/a.html" target="_blank" rel="noopener">http://a.com:8080/a.html</a> , 其中页面iframe的地址是b.com，和网页不同源的。可以看到该frame可以正确加载，但我们不能用js操作它</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-7b6c2c22cc45104c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>用b.com 打开a.html, <a href="http://b.com:8080/a.html" target="_blank" rel="noopener">http://b.com:8080/a.html</a> , 其中frame 的地址是b.com，和网页同源的，现在我们就可以用 js 获取 iframe里面的内容</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-512536f64dfbb110.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h5 id="（2）修改源-document-domain"><a href="#（2）修改源-document-domain" class="headerlink" title="（2）修改源 document.domain"></a>（2）修改源 document.domain</h5><p>当两个url的主域名不同，但子域名相同的情况下，我们可以通过<iframe>标签将目标url先嵌入html中，再设置页面的document.domain值为两个url共同的子域名，即可实现降域</iframe></p>
<p><strong>注：两个url的子域名必须相同</strong></p>
<p>举个例子</p>
<p>a.jrg.com:8080/a.html 和 b.jrg.com:8080/b.html 页面代码都加上document.domain = “jrg.com”</p>
<p>在a.html页面中建一个iframe，通过iframe，两个js文件即可交互数据</p>
<p>a.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ct"</span>&gt;</span><br><span class="line">  &lt;h1&gt;使用降域实现跨域&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="main"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;input type="text" placeholder="http:/</span><span class="regexp">/a.jrg.com:8080/</span>a.html<span class="string">"&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;iframe src="</span>http:<span class="comment">//b.jrg.com:8080/b.html" frameborder="0" &gt;&lt;/iframe&gt;</span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/URL: http:/</span><span class="regexp">/a.jrg.com:8080/</span>a.html</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'.main input'</span>).addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">  <span class="built_in">window</span>.frames[<span class="number">0</span>].document.querySelector(<span class="string">'input'</span>).value = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">"jrg.com"</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>b.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// URL: http://b.jrg.com:8080/b.html</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'#input'</span>).addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">window</span>.parent.document.querySelector(<span class="string">'input'</span>).value = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">'jrg.com'</span>;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4､PostMessage"><a href="#4､PostMessage" class="headerlink" title="4､PostMessage"></a>4､PostMessage</h4><p>允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递。</p>
<p>举个例子 (实现iframe跨域通信)</p>
<p>a.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style&gt;</span></span><br><span class="line"><span class="regexp">	.ct&#123;</span></span><br><span class="line"><span class="regexp">		width: 910px;</span></span><br><span class="line"><span class="regexp">		margin: 0 auto;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	.main&#123;</span></span><br><span class="line"><span class="regexp">		float: left;</span></span><br><span class="line"><span class="regexp">		width: 450px;</span></span><br><span class="line"><span class="regexp">		height: 300px;</span></span><br><span class="line"><span class="regexp">		border: 1px solid #ccc;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	.main input&#123;</span></span><br><span class="line"><span class="regexp">		margin: 20px;</span></span><br><span class="line"><span class="regexp">		width: 200px;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	.iframe&#123;</span></span><br><span class="line"><span class="regexp">		float: right;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	iframe&#123;</span></span><br><span class="line"><span class="regexp">		width: 450px;</span></span><br><span class="line"><span class="regexp">		height: 300px;</span></span><br><span class="line"><span class="regexp">		border: 1px dashed #ccc;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"ct"</span>&gt;</span><br><span class="line">		&lt;h1&gt;使用postMessage实现跨域&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>div&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"main"</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"http://a.jrg.com:8080/a.html"</span>&gt;</span><br><span class="line">	&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	&lt;iframe src="http:/</span><span class="regexp">/localhost:8080/</span>b.html<span class="string">" frameborder="</span><span class="number">0</span><span class="string">"&gt;&lt;/iframe&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">//URL http://a.jrg.com:8080/a.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$('.main input').addEventListener('input',function()&#123;</span></span><br><span class="line"><span class="string">	console.log(this.value);</span></span><br><span class="line"><span class="string">	window.frames[0].postMessage(this.value,'*');</span></span><br><span class="line"><span class="string">	// a.html向跨域的iframe页面http://localhost:8080/b.html传递数据</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//监听有没有数据发送过来</span></span><br><span class="line"><span class="string">window.addEventListener('message',function(e)&#123;</span></span><br><span class="line"><span class="string">	$('.main input').value = e.data</span></span><br><span class="line"><span class="string">	console.log(e.data)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">function $(id)&#123;</span></span><br><span class="line"><span class="string">	return document.querySelector(id)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>b.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;style&gt;</span></span><br><span class="line"><span class="regexp">	html,body&#123;</span></span><br><span class="line"><span class="regexp">		margin: 0;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	input&#123;</span></span><br><span class="line"><span class="regexp">		margin: 20px;</span></span><br><span class="line"><span class="regexp">		width: 200px;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input id=<span class="string">"input"</span> type=<span class="string">"text"</span> placeholder=<span class="string">"http://b.jrg.com:8080/b.html"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// URL http://b.jrg.com:8080/b.html</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">'#input'</span>).addEventListener(<span class="string">'input'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">window</span>.parent.postMessage(<span class="keyword">this</span>.value,<span class="string">'*'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">	$(<span class="string">'#input'</span>).value = e.data</span><br><span class="line">	<span class="built_in">console</span>.log(e.data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">document</span>.querySelector(id)</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>启动http-server，查看执行结果</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-b6f0d1c6cde0e53c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-709d9265ccbb1d74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>总结一下：</p>
<p>A、a.html 通过 <code>window.postMessage()</code> 发送一个信息给b.html</p>
<p>B、b.html 在 <code>window</code> 上添加一个事件监听绑定 <code>message</code> 事件，可以接收到来自任何不同域名通过 <code>postMessage</code> 方法发送过来的信息</p>
<p>C、当 b.html 接收到 a.html 发送过来的信息时执行监听事件就 OK，在监听事件的 <code>event</code> 参数中包含了所有 <code>message</code> 事件接收到的相关数据。包括发送信息的内容 <code>event.data</code>，发送信息的域名 <code>event.origin</code> 等等</p>
<p>同样的，在 a.html 内添加一个事件监听绑定 <code>message</code> 事件，在 b.html 内通过 <code>postMessage</code>方法发送信息给 a.html 一样可以进行跨域通信</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/05/音乐播放器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/05/音乐播放器/" itemprop="url">音乐播放器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-05T16:38:11+08:00">
                2018-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>哎呀呀，最近在做一个音乐播放器，做的过程中遇到了一些小问题，记载下，防止下次再犯</p>
<h2 id="一、play-失效"><a href="#一、play-失效" class="headerlink" title="一、play 失效"></a>一、play 失效</h2><p>(1) 代码测试play时（<code>audioObject.play()</code>）,播放不了， Chrome浏览器预览时报错</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-630f4a56b58e612a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)设置autoplay-policy</p>
<p>网上查了资料才知道,是chrome 的 autoplay 的政策原因造成的。 <strong>audio video 必须通过用户交互之后才可以播放</strong>。</p>
<p>但是可以通过将Chrome标记“自动播放策略”设置为“无需用户手势”来决定完全禁用自动播放策略<code>chrome://flags/#autoplay-policy</code>。这使您可以测试您的网站，就像用户与您的网站密切合作一样，并且始终允许播放自动播放</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-5c62114e15094402.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>如上图设置好后，刷新页面预览时，就可以啦。</p>
<p>可参考 <a href="https://developers.google.com/web/updates/2017/09/autoplay-policy-changes" target="_blank" rel="noopener">https://developers.google.com/web/updates/2017/09/autoplay-policy-changes</a></p>
<h3 id="二、gitpages预览报错"><a href="#二、gitpages预览报错" class="headerlink" title="二、gitpages预览报错"></a>二、gitpages预览报错</h3><p>提交到github时，使用gitpages预览时，数据请求不到，原因是域名是github.com，所以代码这里要加上对应的仓库名才行，不然会报错</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-4b21e3d21b7848e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/04/搭建服务器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/04/搭建服务器/" itemprop="url">搭建服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-04T09:32:34+08:00">
                2018-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、http-server"><a href="#一、http-server" class="headerlink" title="一、http-server"></a>一、http-server</h2><p>使用 http-server node工具启动一个静态服务器</p>
<p>(1)  在终端输入 http-server, 就可以启动一个静态服务器</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-6eb68a207ed910b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  接下来就可以用<a href="http://127.0.0.1:8081" target="_blank" rel="noopener">http://127.0.0.1:8081</a> 查看对应的页面了</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-90e8637502a4390b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>假设简单页面开发，需要测试时，接口可以做成一个文件，叫’/login.json’。</p>
<p>相当于向文件发送请求，然后会返回文件的内容，您把数据的响应内容放到文件里面就可以了，这样的话可以做一个数据的模拟,整个流程就可以跑通</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'/login.json'</span>,<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<p>(3)  假设要做一个网易云音乐</p>
<ul>
<li>首先第一个需要做的，就是要获取它的分类 ‘/catelog.json’</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'/catelog.json'</span>,<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>然后接下来在当前的html对应的目录下新建catelog.json文件,里面的内容是就是我们的分类的数据，是json格式的数据。把当前html文件和catelog.json文件放同一级目录,这时把代码上传到githubpages或其他静态服务器后，这功能就有了，当向’/catelog.json’接口发请求，就能得到数据，不需要任何的后台或平台就可以得到数据了</li>
</ul>
<h2 id="二、GitHubPages-mock数据"><a href="#二、GitHubPages-mock数据" class="headerlink" title="二、GitHubPages mock数据"></a>二、GitHubPages mock数据</h2><p>(1)  首先需要在同一级目录下新建html和json文件，即song.html和song.json文件，如下图</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-6ddd6296ae6cecc2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>song.html页面代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;<span class="xml"><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="regexp">xhr.open('GET','/</span>testmusic/song.json<span class="string">',true)</span></span><br><span class="line"><span class="string">//song.json前一定要加'</span>/testmusic<span class="string">'，因为域名是github.com</span></span><br><span class="line"><span class="string">xhr.send()</span></span><br><span class="line"><span class="string">xhr.onload = function()&#123;</span></span><br><span class="line"><span class="string">    console.log(JSON.parse(xhr.responseText))</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br></pre></td></tr></table></figure>
<p>song.json页面代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;90后&quot;,&quot;80后&quot;,&quot;哈哈&quot;]</span><br></pre></td></tr></table></figure>
<p>(2)  设置下，使用githubpages ,做一个预览</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-adb68a2c5dc9e969.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3).  打开这个页面song.html</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-d8668c9c73d22044.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4)  就获取到数据啦<br><img src="https://upload-images.jianshu.io/upload_images/9375265-6514b129b355b5d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="三、server-mock"><a href="#三、server-mock" class="headerlink" title="三、server-mock"></a>三、server-mock</h2><p>使用 server-mock node工具启动一个能处理静态文件和动态路由的服务器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>()&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'getWeather'</span>:</span><br><span class="line">        	res.end(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;))</span><br><span class="line">    		<span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">'/user/123'</span>:</span><br><span class="line">        	res.end(fs.readFileSync(__dirname + <span class="string">'/static/user.tpl'</span>))</span><br><span class="line">    		<span class="keyword">break</span>;</span><br><span class="line">    	<span class="keyword">default</span>:</span><br><span class="line">    		res.end(fs.readFileSync(__dirname + <span class="string">'/static'</span> + req.url))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="四、手写一个服务器"><a href="#四、手写一个服务器" class="headerlink" title="四、手写一个服务器"></a>四、手写一个服务器</h2><p>可参照    <a href="https://github.com/jirengu/node-server&gt;" target="_blank" rel="noopener">https://github.com/jirengu/node-server&gt;</a></p>
<h2 id="五、线上mock-数据"><a href="#五、线上mock-数据" class="headerlink" title="五、线上mock 数据"></a>五、线上mock 数据</h2><p>(1)  使用 <a href="http://easy-mock.com/" target="_blank" rel="noopener">http://easy-mock.com/</a></p>
<p>(2)  使用 <a href="http://rapapi.org/org/index.do" target="_blank" rel="noopener">http://rapapi.org/org/index.do</a></p>
<p>(3)  使用 server-mock</p>
<h2 id="六、简单来说说easymock"><a href="#六、简单来说说easymock" class="headerlink" title="六、简单来说说easymock"></a>六、简单来说说easymock</h2><p>(1)  首先进去网页，第一次进来是没有注册的， 直接用户名和密码登录就好</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-78d009374f69f80f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  登录后，开始建立项目</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-62dbea526fe12bad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-aea63812e30e43d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3)  点创建钮后，就建立了一个项目</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-f304db7c6a9441f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(4)  接下来，点击红框处</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-565fe2d5b3800058.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(5)  开始建立接口啦</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-3e71f3de6a47e939.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(6)  填写相关信息</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-401e59f2b71fa887.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(7)  接口创建好</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-d06052f578ab903e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>现在来编辑，点上图操作下方的第二个小标，进入编辑页面,编辑好并预览</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-55f6f7113317b4e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(8)  点预览,显示结果是</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-8e68c5a52d1dc95c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(9)  我们可以复制接口地址在终端，用命令curl查看结果</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-5385b986fe213471.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-23e8ef9ad7276688.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(10)  我们也可以在本地测试这个接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'https://easy-mock.com/mock/5c0614d154d29d7973e87912/getType'</span>,<span class="literal">true</span>)</span><br><span class="line">xhr.send()</span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xhr.status &gt;=<span class="number">200</span> &amp;&amp; xhr.status &lt;<span class="number">300</span> || xhr.status === <span class="number">304</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(11)  打开静态服务器，终端输入http-server,然后浏览器预览，结果为</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-2683acdc53ca1627.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>换句话说，我们发了请求的接口，可以是我们之前线上easymock定义的接口，可以定义好接口人，名字,数据，这样子，不管在服务器上还是在本地，都可以做一个演示</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/25/nodejs实现静态服务器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/25/nodejs实现静态服务器/" itemprop="url">nodejs实现静态服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-25T22:30:00+08:00">
                2018-11-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看了一天的nodejs 实现静态服务器 ,还是晕乎乎，费话不说了，直接上代码，记笔记吧！</p>
<h3 id="一、案例"><a href="#一、案例" class="headerlink" title="一、案例"></a>一、案例</h3><p>(1)  首先是页面index.js代码如下：</p>
<p>例1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># require-----nodejs通过它来加载模块</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>) </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">http是nodejs的内置模块,它是一个对象，然后这个对象提供了一些方法，实现我们所需要的一些功能</span></span><br><span class="line"><span class="comment">整个服务器底层都是由nodejs的http模块实现的</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">函数createServer内部是一个异步的过程,内部会创建一个服务器，创建服务器时里面有一个回调function(req,res),把函数function(req,res)作为对应的参数，来处理我们的请求</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">换句话说，创建服务器后，当浏览器访问这个服务器时,那请求呢，底层会封装成一个对象，这个对象就是第一个参数，是req,可以随便起名</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">req 用户请求的信息都在这里，用户的(ip ,访问的域名,浏览器的一些信息)</span></span><br><span class="line"><span class="comment">res 需要返回给用户哪些东西的这个对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"># res.write是把数据放到响应体Response里面</span><br><span class="line"># 响应体 是 页面的查看源代码，</span><br><span class="line"># 响应头 是 Response Header</span><br><span class="line"></span><br><span class="line"><span class="comment">//setHeader 设置响应头 </span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line">     res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">"text/paint; charset=utf-8"</span>)</span><br><span class="line">     res.write(<span class="string">'&lt;h1&gt; 你好&lt;/h1&gt;'</span>) </span><br><span class="line">     res.end()</span><br><span class="line"> &#125;)</span><br><span class="line"> server.listen(<span class="number">9000</span>) <span class="comment">// listen方法 启动服务器 ,使这个服务器监听 9000端口</span></span><br></pre></td></tr></table></figure>
<p>例2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">/*text/plain 告诉浏览器，你接收到的字符串，你把它当成字符去渲染.  </span></span><br><span class="line"><span class="comment">      text/html 告诉浏览器，你接收到的字符串，你把它当成html去渲染</span></span><br><span class="line"><span class="comment">      charset=utf-8 告诉浏览器，用 utf-8解码</span></span><br><span class="line"><span class="comment">      charset=bgk 告诉浏览器，用 bgk 解码</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    response.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/html; charset=utf-8'</span>)</span><br><span class="line">    <span class="comment">//response.writeHead(404, 'Not Found')</span></span><br><span class="line">    response.writeHead(<span class="number">200</span>,<span class="string">'haha'</span>) <span class="comment">// 相当于 状态码 status code</span></span><br><span class="line">    response.write(<span class="string">'&lt;html&gt;&lt;head&gt;&lt;meta charset="gbk" /&gt;&lt;/head&gt;'</span>)</span><br><span class="line">    response.write(<span class="string">'&lt;body&gt;'</span>)</span><br><span class="line">    response.write(<span class="string">'&lt;h1&gt;你好&lt;/h1&gt;'</span>)</span><br><span class="line">    response.write(<span class="string">'&lt;/body&gt;'</span>)</span><br><span class="line">    response.write(<span class="string">'&lt;/html&gt;'</span>)</span><br><span class="line">    </span><br><span class="line">    response.end()</span><br><span class="line">  &#125;,<span class="number">2000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'open http://localhost:8080'</span>)</span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>(2)  接下来是终端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ cd node-server <span class="comment">// 去到对应的目录</span></span><br><span class="line">➜  node-server git:(master) ✗ cd step0</span><br><span class="line">➜  step0 git:(master) ✗ node index.js <span class="comment">//通过node 加上文件名, 启动服务器</span></span><br><span class="line"></span><br><span class="line">如果页面有更改需关闭服务器重新启动，终端操作 ctrl + c 关闭，然后重新启动 node index.js即可!</span><br></pre></td></tr></table></figure>
<p>(3)  然后浏览器地址输入如下地址 浏览即可！其中9000是对应的端口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost: <span class="number">9000</span></span><br></pre></td></tr></table></figure>
<p>例3 实现一个静态服务器</p>
<p>(1)  把我们的代码放到static文件夹下,</p>
<p>(2)  把我们的网站放到远程的机器在上</p>
<p>(3)  然后通过执行<strong>node server.js</strong> 去运行服务器</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-a85157201549beb2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="list.jpg"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>) <span class="comment">//创建服务器的模块</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>) <span class="comment">//处理文件路径的模块,自动识别url类型</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>) <span class="comment">// 读写文件的 ，读到数据，也可以往文件里写东西</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>) <span class="comment">// 自动解析url 得到一些信息 </span></span><br><span class="line"><span class="comment">/*相当于location, url 作为参数，然后进行解析，得到一个对象,然后我们可以使用里面的某些部分了</span></span><br><span class="line"><span class="comment">不用使用正则去提取啦*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">staticRoot</span>(<span class="params">staticPath,req,res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(staticPath)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(req.url)</span><br><span class="line">    <span class="keyword">var</span> pathObj = url.parse(req.url,<span class="literal">true</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(pathObj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if(pathObj.pathname === '/')&#123;</span></span><br><span class="line"><span class="comment">    pathObj.pathname += 'index.html'</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">index.html 作为默认的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> filePath = path.join(staticPath,pathObj.pathname)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 同步读文件</span></span><br><span class="line"><span class="comment">var fileContent = fs.readFileSync(filePath,'binary')</span></span><br><span class="line"><span class="comment">res.write(fileContent,'binary')</span></span><br><span class="line"><span class="comment">res.end()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//异步读文件</span></span><br><span class="line">fs.readFile(filePath,<span class="string">'binary'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,fileContent</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'404'</span>)</span><br><span class="line">        res.writeHead(<span class="number">404</span>,<span class="string">'not find'</span>)</span><br><span class="line">        res.end(<span class="string">'&lt;h1&gt; 404 Not Found'</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'ok'</span>)</span><br><span class="line">       res.writeHead(<span class="number">200</span>,<span class="string">'ok'</span>)</span><br><span class="line">       res.write(fileContent,<span class="string">'binary'</span>)</span><br><span class="line">       res.end()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(path.join(__dirname,<span class="string">'static'</span>))</span><br><span class="line"><span class="comment">//__dirname：当前模块的文件夹名称，nodejs内置的变量，代表当前代码的server.js的文件夹路径。也就是step1的绝对路径,然后拼上static路径，最终static的绝对路径</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    staticRoot(path.join(__dirname,<span class="string">'static'</span>),req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'visit http://localhost:8080'</span>)</span><br></pre></td></tr></table></figure>
<p>__dirname 请参照 <a href="http://nodejs.cn/api/modules.html#modules_dirname" target="_blank" rel="noopener">http://nodejs.cn/api/modules.html#modules_dirname</a></p>
<h2 id="二、总结"><a href="#二、总结" class="headerlink" title="二、总结"></a>二、总结</h2><p><strong>A、看图说话吧</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9375265-3999c2e18dac389d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pic.jpg"></p>
<p>(1)  用户的浏览器随便输入一个URL，<a href="http://localhost:8080/a/b/c" target="_blank" rel="noopener">http://localhost:8080/a/b/c</a> </p>
<p>(2)  这时浏览器会把这个请求向这个域名<a href="http://localhost:8080对应的IP去发送" target="_blank" rel="noopener">http://localhost:8080对应的IP去发送</a></p>
<p>(3)  发完之后这个请求从左边浏览器到了右边的远程机器上</p>
<p>(4)  然后根据端口进行匹配,匹配上后，交给某个服务器</p>
<p>(5)  这个服务器就拿到了这个请求,一个请求可以当成一个对象,对象里有关于这个请求的信息</p>
<p>(6)  拿到之后，在服务器里进行处理,处理好之后，把结果再从服务器发回浏览器,就行了</p>
<p>注：发回去分为两部分，一个是<strong>响应头</strong>，一个是<strong>响应体</strong></p>
<p><strong>B、来一个简单版的静态服务器 server-simple.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(__dirname + <span class="string">'/static'</span> + req.url)</span><br><span class="line">    <span class="comment">// 当一个请求到来时，通过当前的目录（__dirname）step1,加上'/static'，再加上'req.url',拼装成一个完整的路径</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> fileContent = fs.readFileSync(__dirname + <span class="string">'/static'</span> + req.url)</span><br><span class="line">        <span class="comment">// 然后去读这个文件,读完之后，得到结果</span></span><br><span class="line">        res.write(fileContent) <span class="comment">// 得到结果之后，再把结果发出去 </span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        res.writeHead(<span class="number">404</span>,<span class="string">'not found'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'visit http://localhost:8080'</span>)</span><br></pre></td></tr></table></figure>
<p>如需要nodejs 服务器 路由解析 上面代码改为：</p>
<p><strong>其中路由是指域名后边的东西 如：localhost:8080/user/123 中的 ‘/user/123’</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(req.url)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'getWeather'</span>:</span><br><span class="line">        	res.end(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;))</span><br><span class="line">        	<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'user/123'</span>:</span><br><span class="line">        	res.end(fs.readFileSync(__dirname + <span class="string">'/static/user.tpl'</span>))</span><br><span class="line">        	<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        	res.end(fs.readFileSync(__dirname + <span class="string">'/static'</span> + req.url))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/19/ajax/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/19/ajax/" itemprop="url">ajax</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-19T17:25:20+08:00">
                2018-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、定义"><a href="#一、定义" class="headerlink" title="一、定义"></a>一、定义</h2><p>全称是异步的Javascript and XML)</p>
<p>Ajax 是一种技术方案，但并不是一种新技术。它依赖的是现有的CSS/HTML/Javascript,而其中最核心的依赖是浏览器提供的XMLHttpRequest对象，是这个对象使得浏览器可以发出HTTP请求与接收HTTP响应。实现在页面不刷新的情况下和服务端进行数据交互。</p>
<p>一句话总结：我们使用<code>XMLHttpRequest</code>对象来发送一个<code>Ajax</code>请求</p>
<p>来一个简易版实例（写一个ajax）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()<span class="comment">//建立对象</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'/hello.json'</span>,<span class="literal">true</span>)</span><br><span class="line"><span class="comment">//创建一个GET请求，采用异步,true表示异步，异步代表需要绑定一个事件</span></span><br><span class="line"><span class="comment">// "/hello.json"表示域名+/hello.json,如果http-server打开静态服务器，127.0.0.1:8080/hello.json</span></span><br><span class="line">xhr.send()<span class="comment">//发送请求</span></span><br><span class="line">xhr.addEventListener(<span class="string">'load'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> data = xhr.responseText</span><br><span class="line">       <span class="built_in">console</span>.log(data)    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果是同步请求的话，代码是这样子的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'/hello.json'</span>,<span class="literal">false</span>) <span class="comment">//设置参数，false表示同步</span></span><br><span class="line">xhr.send()</span><br><span class="line"><span class="keyword">var</span> data = xhr.responseText</span><br><span class="line"><span class="built_in">console</span>.log(data)</span><br></pre></td></tr></table></figure>
<h2 id="二、同步、异步"><a href="#二、同步、异步" class="headerlink" title="二、同步、异步"></a>二、同步、异步</h2><p><strong>A、同步</strong></p>
<p>我发了一个请求，然后属于等待中，就卡死啦,这个时候只有后端给我响应之后，我才可以继续操作,代码才能继续往下执行</p>
<p>就相当于我在算一个很复杂的数据，花了5分钟一样，在5分钟内一直属于算的状态，所以后面的js 是不执行的,是卡死状态</p>
<p><strong>B、异步：</strong> </p>
<p>我发了一个请求，我就不管了，然后我会去监听我的某一个状态,当状态发生改变时，也就是说达到我的一个需求时或是满足我的条件时,那我再去做一个事情</p>
<p><strong>C、下面这些事件都算异步</strong></p>
<p><strong>(1)  点击事件</strong></p>
<p>绑定一个事件后，我就不管了,就不去执行它,什么时侯去执行呢</p>
<p>当达到某一个条件（用户去点击，或是用户去点击去触发那个事件时）</p>
<p>那我才去执行它</p>
<p><strong>(2)  setTimeout</strong></p>
<p>绑定一个函数后，它不执行,什么时侯去执行呢</p>
<p>当这个时间点到了之后，浏览器内部会发出一个事件（时间到了的这个事件），去执行它</p>
<p><strong>(3)  ajax </strong></p>
<p>也是一样的，我的请求发出去之后，就先不去管了，什么时候去执行呢</p>
<p>当我这里面内部状态发生改变的时侯，我监听到了，我觉得该去处理了，我就去处理它</p>
<h2 id="三、完善上面的代码"><a href="#三、完善上面的代码" class="headerlink" title="三、完善上面的代码"></a>三、完善上面的代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'/hello.json'</span>,<span class="literal">true</span>)</span><br><span class="line">xhr.send()</span><br><span class="line"></span><br><span class="line"><span class="comment">//readystate的change事件</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xhr.readystate === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>)&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(xhr.responsText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// xhr.readystate 它的交互流程是否完毕，有没结束</span></span><br><span class="line"><span class="comment">// xhr.status 服务器的状态 表示数据是否ok,是否正常</span></span><br><span class="line"></span><br><span class="line">xhr.addEventListener(<span class="string">'readystatechange'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'readystate:'</span>,xhr.readyState)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//load是 readyState变为4时，会自动触发load,所以我们不用管readyState ，直接写onload, 表示 readyState是4啦</span></span><br><span class="line">xhr.addEventListener(<span class="string">'load'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.status)</span><br><span class="line">    <span class="keyword">if</span>(xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span> || xhr.status === <span class="number">304</span>)&#123;</span><br><span class="line">       <span class="keyword">var</span> data = xhr.responseText</span><br><span class="line">       <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'error'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>最后完善：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/hello.json'</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">            <span class="comment">//成功了</span></span><br><span class="line">            <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'服务器异常'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器异常'</span>)</span><br><span class="line">&#125;</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure>
<p>换种写法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'hello.json'</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">        <span class="comment">//成功了</span></span><br><span class="line">        <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'服务器异常'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器异常'</span>)</span><br><span class="line">&#125;</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure>
<h2 id="四、GET、POST形式案例"><a href="#四、GET、POST形式案例" class="headerlink" title="四、GET、POST形式案例"></a>四、GET、POST形式案例</h2><p>(1)  GET形式的数据请求 (<strong>数据拼装成url形式</strong>)</p>
<p>准确地说是传递参数(username、password)  把数据拼装成url形式,放到?后面】</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'/login?username=xwu&amp;password=123'</span>,<span class="literal">true</span>)</span><br><span class="line">xhr.send()</span><br><span class="line"></span><br><span class="line"><span class="comment">//readystate的change事件</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xhr.readystate === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>)&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(xhr.responsText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// xhr.readystate 它的交互流程是否完毕，有没结束</span></span><br><span class="line"><span class="comment">// xhr.status 服务器的状态 表示数据是否ok,是否正常</span></span><br><span class="line"></span><br><span class="line">xhr.addEventListener(<span class="string">'readystatechange'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'readystate:'</span>,xhr.readyState)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//load是 readyState变为4时，会自动触发load,所以我们不用管readyState ，直接写onload, 表示 readyState是4啦</span></span><br><span class="line">xhr.addEventListener(<span class="string">'load'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.status)</span><br><span class="line">    <span class="keyword">if</span>(xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span> || xhr.status === <span class="number">304</span>)&#123;</span><br><span class="line">       <span class="keyword">var</span> data = xhr.responseText</span><br><span class="line">       <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'error'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>(2)  POST形式数据请求 (<strong>直接发送数据</strong>)</p>
<p>准确地说是不会把数据拼装成url形式,而是把数据拼好了放到send里面。当然数据拼接的过程可以写一个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'POST'</span>,<span class="string">'/login'</span>,<span class="literal">true</span>)</span><br><span class="line"><span class="comment">//xml.send('username=xwupassword=123')</span></span><br><span class="line">xhr.send(makeUrl(&#123;</span><br><span class="line">	username: <span class="string">'xwu'</span>,</span><br><span class="line">	age: <span class="number">2</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">xhr.addEventListener(<span class="string">'load'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(xhr.status)</span><br><span class="line">	<span class="keyword">if</span>((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status === <span class="number">304</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> data = xhr.responseText</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'error'</span>)			</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'error'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">makeUrl(&#123;</span><br><span class="line">	username: <span class="string">'xwu'</span>,</span><br><span class="line">	age: <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeUrl</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> arr = []</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">		arr.push(key + <span class="string">'='</span> + obj[key])</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> arr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3)  封装一个ajax</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">opts</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = opts.url</span><br><span class="line">    <span class="keyword">var</span> type = opts.type || <span class="string">'GET'</span></span><br><span class="line">    <span class="keyword">var</span> dataType = opts.dataType || <span class="string">'json'</span></span><br><span class="line">    <span class="keyword">var</span> onsuccess = opts.onsuccess || <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">var</span> onerror = opts.onerror || <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">var</span> data = opts.data || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dataStr = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> data)&#123;</span><br><span class="line">        dataStr.push(key + <span class="string">'='</span> + data[key])</span><br><span class="line">    &#125;</span><br><span class="line">    dataStr = dataStr.join(<span class="string">'&amp;'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(type === <span class="string">'GET'</span>)&#123;</span><br><span class="line">        url += <span class="string">'?'</span> + dataStr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    xhr.open(type, url, <span class="literal">true</span>)</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">            <span class="comment">//成功了</span></span><br><span class="line">            <span class="keyword">if</span>(dataType === <span class="string">'json'</span>)&#123;</span><br><span class="line">                onsuccess( <span class="built_in">JSON</span>.parse(xhr.responseText))</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                onsuccess( xhr.responseText)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            onerror()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.onerror = onerror</span><br><span class="line">    <span class="keyword">if</span>(type === <span class="string">'POST'</span>)&#123;</span><br><span class="line">        xhr.send(dataStr)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        xhr.send()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ajax(&#123;</span><br><span class="line">    url: <span class="string">'http://api.jirengu.com/weather.php'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        city: <span class="string">'北京'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onsuccess: <span class="function"><span class="keyword">function</span>(<span class="params">ret</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ret)</span><br><span class="line">    &#125;,</span><br><span class="line">    onerror: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'服务器异常'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>参考  <a href="https://segmentfault.com/a/1190000004322487" target="_blank" rel="noopener">https://segmentfault.com/a/1190000004322487</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/18/cookie、session、localStorage/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wuer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wuer">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/18/cookie、session、localStorage/" itemprop="url">cookie、session、localStorage</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-18T16:35:39+08:00">
                2018-11-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、cookie"><a href="#一、cookie" class="headerlink" title="一、cookie"></a>一、cookie</h1><h3 id="A、定义"><a href="#A、定义" class="headerlink" title="A、定义"></a>A、定义</h3><p>存储在浏览器上的一小段数据，用来记录某些当页面关闭或刷新后仍然需要记录的信息。</p>
<h3 id="B、查看"><a href="#B、查看" class="headerlink" title="B、查看"></a>B、查看</h3><p>(1)  在控制台用 document.cookie 查看你当前正在浏览的网站的cookie<br><img src="https://upload-images.jianshu.io/upload_images/14339384-cc44d49dbab37437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(2)  每次网络请求Request headers中都会带上cookie. 所以如果cookie 太多太大对传输效率会有影响。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-5dca60da8dcada16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>(3) 清除cookie ，cookie没啦，刷新页面，cookie又出现啦！</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-da8d1dfc8c990ee0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-5a4a7206a9a7828a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-9ebcea4e62e18636.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="C、作用"><a href="#C、作用" class="headerlink" title="C、作用"></a><strong>C、作用</strong></h3><p>(1)  可以使用js 在浏览器直接设置（用于记录不敏感信息，如用户名)</p>
<p>(2)  也可 以在服务端使用HTTP协议规定的set-cookie来让浏览器种下cookie,这是最常见的做法。（打开一个网站，清除全部cookie, 然后刷新页面，在network的Response headers 试试找一找set-cookie吧）</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-7a0a81d350173c32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>注： 浏览器接受setcookie之后，会把内容种植到浏览器的cookie内部，之后向服务器发送的请求就都会带cookie</p>
<h3 id="D、参数"><a href="#D、参数" class="headerlink" title="D、参数"></a>D、参数</h3><p>(1)  <strong>path</strong>: 表示cookie影响到的路径，匹配该路径才发送这个cookie。</p>
<p>expires和maxAge: 告诉浏览器cookie时候过期，maxAge是cookie多久后过期的相对时间。不设置这两个选项时会产生session cookie，session cookie 是transient的，当用户关闭浏览器时，就被清除。一般用来保存session 的 session 的 session_id。</p>
<p>(2)  <strong>secure</strong>：当secure值为true时，cookie在HTTP中是无效，在HTTPS中才有效</p>
<p>(3)  <strong>httpOnly</strong>：浏览器不允许脚本操作document.cookie去更改cookie。一般情况下都应该设置这个为true。这样可以避免被xss 攻击拿到 cookie。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-1d15a091e7141c27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><strong>注</strong>：一般浏览器存储cookie 最大容量为<strong>4k</strong>,所以大量数据不要存到cookie</p>
<h1 id="二、session"><a href="#二、session" class="headerlink" title="二、session"></a>二、session</h1><h3 id="A、定义-1"><a href="#A、定义-1" class="headerlink" title="A、定义"></a>A、定义</h3><p>当一个用户打开淘宝登录后，刷新浏览器仍然展示登录状态。服务器如何分辨这次发起请求的用户是刚才登录过的用户呢？这时就使用了session保存状态。</p>
<h3 id="B、用途"><a href="#B、用途" class="headerlink" title="B、用途"></a>B、用途</h3><p>(1)  用户在输入用户名密码提交给服务端，服务端验证通过后会创建一个session用于记录用户的相关信息。这个session可保存在服务器内存中，也可保存在数据库中。</p>
<p>(2)  创建session后，会把关联的session_id通过setCookie添加一http响应头部中。</p>
<p>(3)  浏览器在加载页面时发现响应头部有set-cookie字段，就把这个cookie种到浏览器指定域名中。</p>
<p>(4)  当下次刷新页面时，发送的请求会带上这条cookie,服务端在接收到后根据这个session_id来识别用户。</p>
<p>cookie是存储在浏览器里的一小段数据，而session是一种让服务器能识别某个用户的机制，session在实现的过程中需要使用cookie。二者不是同一维度的东西。</p>
<h1 id="三、localStorage"><a href="#三、localStorage" class="headerlink" title="三、localStorage"></a>三、localStorage</h1><h3 id="A、定义-2"><a href="#A、定义-2" class="headerlink" title="A、定义"></a>A、定义</h3><p>(1)  localStorage HTML5本地存储web storage 特性之一，用于将大量数据（最大5M）保存在浏览器中，保存后数据永远不会失效过期，除非用js 手动清除。</p>
<p>(2)  不参与网络传输</p>
<p>(3)  一般用于性能优化，可以保存图片、js、css、html模板、大量数据</p>
<h3 id="B、js控制"><a href="#B、js控制" class="headerlink" title="B、js控制"></a>B、js控制</h3><p>把它当成一个对象就行了啦</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14339384-85674dbc556b6d44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>注： 存入对象，需把对象<strong>转换为字符串</strong>，不然 value 读取不到值，显示 [object object]</p>
<h1 id="四、区别"><a href="#四、区别" class="headerlink" title="四、区别"></a>四、区别</h1><p>sessionStorage、localStorage是HTML5提供的Web Storage API提供的，可以避免数据在<strong>浏览器和服务器</strong>之间不必要的来回传递。  sessionStorage、 localStorage 、 cookie 都是在<strong>浏览器端</strong>存储的数据。  </p>
<p>三者之间的区别 </p>
<h4 id="cookie"><a href="#cookie" class="headerlink" title="cookie:"></a>cookie:</h4><p>(1)  每个域名的存储量有限（一般是4k）      </p>
<p>(2)  所有域名的存储量有限  </p>
<p>(3)  会跟随请求被发送到服务器上  </p>
<p>(4)  有个数限制，不同浏览器下，一个域名下cookie的个数有限，并且限制数量可能不一样  </p>
<h4 id="sessionStorage"><a href="#sessionStorage" class="headerlink" title="sessionStorage:"></a>sessionStorage:</h4><p>(1)  当浏览器窗口关闭的时候， sessionStorage 就会被销毁  </p>
<p>(2)  存储容量大(一般比localStorage的存储容量大)  </p>
<h4 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage:"></a>localStorage:</h4><p>(1)  在客户端永久保存  </p>
<p>(2)  单个域名的存储容量大(一般为5M)  </p>
<p>(3)  总体数量无限制</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Wuer</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wuer</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
